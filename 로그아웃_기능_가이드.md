# 🚪 로그아웃 기능 가이드

## ✅ 구현된 기능

로그아웃 기능이 다음 위치에 추가되었습니다:

### 1. **로비 페이지** (`/lobby`)
- 상단에 현재 로그인된 이메일 표시
- 우측에 "🚪 로그아웃" 버튼 추가
- 학생과 교사 모두 사용 가능

### 2. **교사 대시보드** (`/teacher/dashboard`)
- 헤더 우측에 "🚪 로그아웃" 버튼 추가
- "로비로" 버튼 옆에 배치

---

## 🎯 사용 방법

### 학생/교사 로그아웃

1. **로비 페이지**에서:
   - 상단 우측의 "🚪 로그아웃" 버튼 클릭
   - 확인 대화상자에서 "확인" 클릭
   - 로그인 페이지로 자동 이동

2. **교사 대시보드**에서:
   - 헤더 우측의 "🚪 로그아웃" 버튼 클릭
   - 확인 대화상자에서 "확인" 클릭
   - 로그인 페이지로 자동 이동

---

## 🔒 보안 기능

### 1. 확인 대화상자
```
"정말 로그아웃 하시겠습니까?"
```
- 실수로 로그아웃하는 것을 방지
- 취소 가능

### 2. 세션 완전 삭제
```typescript
await supabase.auth.signOut();
```
- Supabase 세션 완전 제거
- 쿠키 삭제
- 로컬 스토리지 정리

### 3. 자동 리다이렉트
- 로그아웃 성공 시 로그인 페이지(`/`)로 이동
- 뒤로가기 방지

---

## ⚠️ 예상되는 문제 및 해결책

### 문제 1: 로그아웃 후에도 페이지 접근 가능

**원인:**
- 브라우저 캐시에 페이지가 남아있음
- Middleware가 제대로 작동하지 않음

**해결책:**
```typescript
// router.push('/') 후 router.refresh() 추가
router.push('/');
router.refresh(); // 페이지 강제 새로고침
```

**이미 적용됨:** ✅ `LogoutButton` 컴포넌트에 구현

---

### 문제 2: 로그아웃 버튼 클릭 시 오류

**원인:**
- 네트워크 문제
- Supabase 연결 문제

**해결책:**
```typescript
try {
  const { error } = await supabase.auth.signOut();
  if (error) throw error;
} catch (error) {
  console.error('로그아웃 에러:', error);
  alert('로그아웃 중 오류가 발생했습니다.');
}
```

**이미 적용됨:** ✅ 에러 처리 구현

---

### 문제 3: 로그아웃 중 버튼 중복 클릭

**원인:**
- 로그아웃 처리 중 버튼을 여러 번 클릭

**해결책:**
```typescript
const [loggingOut, setLoggingOut] = useState(false);

// 버튼 비활성화
<button disabled={loggingOut}>
  {loggingOut ? '로그아웃 중...' : '🚪 로그아웃'}
</button>
```

**이미 적용됨:** ✅ 로딩 상태 관리

---

### 문제 4: 테스트 중 로그아웃 시 데이터 손실

**원인:**
- 테스트 진행 중 로그아웃하면 저장되지 않은 데이터 손실

**해결책:**
- 각 테스트 페이지에서 자동 저장 구현 (이미 구현됨)
- 로그아웃 전 경고 메시지 추가 가능

**권장사항:**
```typescript
// 테스트 페이지에서 beforeunload 이벤트 추가
useEffect(() => {
  const handleBeforeUnload = (e: BeforeUnloadEvent) => {
    if (testInProgress) {
      e.preventDefault();
      e.returnValue = '';
    }
  };
  
  window.addEventListener('beforeunload', handleBeforeUnload);
  return () => window.removeEventListener('beforeunload', handleBeforeUnload);
}, [testInProgress]);
```

---

### 문제 5: 여러 탭에서 로그인 시 동기화 문제

**원인:**
- 한 탭에서 로그아웃해도 다른 탭은 여전히 로그인 상태

**해결책:**
```typescript
// Supabase Auth 상태 변경 감지
useEffect(() => {
  const supabase = createClient();
  
  const { data: { subscription } } = supabase.auth.onAuthStateChange((event) => {
    if (event === 'SIGNED_OUT') {
      router.push('/');
    }
  });

  return () => subscription.unsubscribe();
}, []);
```

**향후 구현 권장:** 📝 필요시 추가

---

## 🧪 테스트 시나리오

### 시나리오 1: 정상 로그아웃
1. 학생 계정으로 로그인
2. 로비 페이지에서 "🚪 로그아웃" 클릭
3. 확인 대화상자에서 "확인" 클릭
4. ✅ 로그인 페이지로 이동
5. ✅ 뒤로가기 시 로그인 페이지 유지

### 시나리오 2: 로그아웃 취소
1. 로비 페이지에서 "🚪 로그아웃" 클릭
2. 확인 대화상자에서 "취소" 클릭
3. ✅ 로비 페이지에 그대로 유지

### 시나리오 3: 교사 로그아웃
1. 교사 계정으로 로그인
2. 교사 대시보드에서 "🚪 로그아웃" 클릭
3. 확인 대화상자에서 "확인" 클릭
4. ✅ 로그인 페이지로 이동
5. 학생 계정으로 다시 로그인 가능

### 시나리오 4: 잘못된 계정 로그인 후 교체
1. 학생 A 계정으로 로그인
2. 로비에서 로그아웃
3. 학생 B 계정으로 로그인
4. ✅ 학생 B의 데이터만 표시됨

### 시나리오 5: 네트워크 오류 시
1. 네트워크 연결 끊기
2. 로그아웃 버튼 클릭
3. ✅ 오류 메시지 표시
4. ✅ 로그인 상태 유지

---

## 🎨 UI/UX 특징

### 1. 시각적 피드백
- **기본 상태**: 반투명 빨간색 배경
- **호버 상태**: 더 진한 빨간색
- **비활성 상태**: 흐린 빨간색, 커서 변경
- **로딩 상태**: "로그아웃 중..." 텍스트

### 2. 색상 코드
```css
기본: rgba(244, 67, 54, 0.2)  /* 연한 빨강 */
호버: rgba(244, 67, 54, 0.4)  /* 중간 빨강 */
비활성: rgba(244, 67, 54, 0.5) /* 흐린 빨강 */
텍스트: #F44336                /* 진한 빨강 */
```

### 3. 애니메이션
- 호버 시 위로 1px 이동
- 0.3초 부드러운 전환 효과

---

## 📋 체크리스트

### 구현 완료 항목
- [x] 로비 페이지 로그아웃 버튼
- [x] 교사 대시보드 로그아웃 버튼
- [x] 확인 대화상자
- [x] 세션 완전 삭제
- [x] 자동 리다이렉트
- [x] 에러 처리
- [x] 로딩 상태 관리
- [x] 중복 클릭 방지
- [x] 현재 로그인 이메일 표시

### 향후 개선 가능 항목
- [ ] 테스트 중 로그아웃 경고
- [ ] 여러 탭 동기화
- [ ] 로그아웃 로그 기록
- [ ] "로그아웃하시겠습니까?" 커스텀 모달
- [ ] 로그아웃 후 "다시 로그인하기" 버튼

---

## 🔧 문제 발생 시 디버깅

### 1. 콘솔 로그 확인
```javascript
// 브라우저 F12 → Console
console.log('로그아웃 시작');
console.log('로그아웃 에러:', error);
```

### 2. 네트워크 탭 확인
```
F12 → Network 탭
→ signOut 요청 확인
→ 상태 코드 확인 (200 = 성공)
```

### 3. Supabase 로그 확인
```
Supabase Dashboard → Logs → Auth Logs
→ signOut 이벤트 확인
```

### 4. 쿠키 확인
```
F12 → Application → Cookies
→ supabase 관련 쿠키 삭제 확인
```

---

## 💡 사용 팁

### 학생용
- 잘못된 계정으로 로그인했다면 즉시 로그아웃
- 테스트 시작 전에 올바른 계정인지 확인
- 공용 컴퓨터에서는 반드시 로그아웃

### 교사용
- 학생 데이터 확인 후 로그아웃
- 여러 교사 계정 전환 시 유용
- 개인정보 보호를 위해 사용 후 로그아웃

---

**로그아웃 기능이 정상적으로 작동합니다! 🎉**

문제가 발생하면 이 가이드를 참조하세요.


# 📚 학생 계정 생성 및 교사 배정 가이드

## 📊 등록 대상 학생 현황

### 총 **112명**의 학생

| 선생님 | 학교 | 학년/반 | 학생 수 |
|--------|------|---------|---------|
| 권해경 선생님 | 나루초 | 3학년 다솜반 | 24명 |
| 이수민 선생님 | 우암초 | 3학년 1반 | 18명 |
| 이수지 선생님 | 단재초 | 4학년 1반 | 24명 |
| 이수지 선생님 | 단재초 | 4학년 2반 | 23명 |
| 이수지 선생님 | 단재초 | 4학년 3반 | 22명 |

---

## 🚀 실행 방법

### 1단계: Supabase SQL Editor 열기

1. Supabase Dashboard 접속
2. 좌측 메뉴에서 **SQL Editor** 클릭
3. **New query** 버튼 클릭

### 2단계: SQL 스크립트 실행

1. `학생_계정_생성_스크립트.sql` 파일 열기
2. 전체 내용 복사 (Ctrl+A, Ctrl+C)
3. Supabase SQL Editor에 붙여넣기 (Ctrl+V)
4. **Run** 버튼 클릭 (또는 Ctrl+Enter)

### 3단계: 결과 확인

스크립트 실행 후 자동으로 다음 정보가 표시됩니다:

#### ✅ 반별 학생 수
```
나루초 3학년 다솜반: 24명
우암초 3학년 1반: 18명
단재초 4학년 1반: 24명
단재초 4학년 2반: 23명
단재초 4학년 3반: 22명
```

#### ✅ 교사별 담당 학생 수
```
권해경 선생님: 24명
이수민 선생님: 18명
이수지 선생님: 69명 (1반 24명 + 2반 23명 + 3반 22명)
```

---

## 🔍 추가 확인 쿼리

### 특정 반 학생 목록 조회

```sql
-- 나루초 3학년 다솜반 학생 목록
SELECT 
  student_number AS 번호,
  full_name AS 이름,
  class_name AS 반,
  grade_level AS 학년
FROM user_profiles
WHERE class_name = '나루초 3학년 다솜반'
ORDER BY CAST(student_number AS INTEGER);
```

### 특정 선생님의 담당 학생 조회

```sql
-- 권해경 선생님 담당 학생
SELECT 
  up.class_name AS 반,
  up.student_number AS 번호,
  up.full_name AS 이름
FROM teacher_student_assignments tsa
JOIN user_profiles up ON tsa.student_id = up.id
WHERE tsa.teacher_id = '14ea1f09-1c7f-43eb-95cf-1b491dd876a4'
ORDER BY up.class_name, CAST(up.student_number AS INTEGER);
```

### 배정되지 않은 학생 찾기

```sql
-- 교사에게 배정되지 않은 학생 확인
SELECT 
  class_name AS 반,
  full_name AS 이름,
  student_number AS 번호
FROM user_profiles
WHERE role = 'student'
  AND class_name IN (
    '나루초 3학년 다솜반',
    '우암초 3학년 1반',
    '단재초 4학년 1반',
    '단재초 4학년 2반',
    '단재초 4학년 3반'
  )
  AND NOT EXISTS (
    SELECT 1 FROM teacher_student_assignments
    WHERE student_id = user_profiles.id
  );
```

---

## 🎓 교사 계정 정보

| 선생님 | UUID | 담당 반 |
|--------|------|---------|
| 권해경 선생님 | `14ea1f09-1c7f-43eb-95cf-1b491dd876a4` | 나루초 3학년 다솜반 |
| 이수민 선생님 | `fe2e88ce-bc53-4c37-825b-4bff261ef1a9` | 우암초 3학년 1반 |
| 이수지 선생님 | `3c9db811-8b08-48bc-8f0e-d515fa045d51` | 단재초 4학년 1,2,3반 |

---

## 📝 학생 정보 수정 방법

### 개별 학생 정보 수정

```sql
-- 학생 이름 수정
UPDATE user_profiles
SET full_name = '새이름'
WHERE full_name = '기존이름' 
  AND class_name = '나루초 3학년 다솜반';

-- 학생 번호 수정
UPDATE user_profiles
SET student_number = '10'
WHERE full_name = '김민주' 
  AND class_name = '나루초 3학년 다솜반';
```

### 학생 삭제

```sql
-- 특정 학생 삭제 (주의: 테스트 결과도 함께 삭제됨)
DELETE FROM user_profiles
WHERE full_name = '학생이름' 
  AND class_name = '나루초 3학년 다솜반';
```

### 학생 추가

```sql
-- 새 학생 추가
INSERT INTO user_profiles (id, full_name, role, class_name, student_number, grade_level)
VALUES (gen_random_uuid(), '새학생', 'student', '나루초 3학년 다솜반', '25', '3학년');

-- 교사에게 배정
INSERT INTO teacher_student_assignments (teacher_id, student_id, class_name)
SELECT 
  '14ea1f09-1c7f-43eb-95cf-1b491dd876a4',
  id,
  class_name
FROM user_profiles
WHERE full_name = '새학생' AND class_name = '나루초 3학년 다솜반';
```

---

## 🔐 학생 로그인 정보 설정

### 방법 1: Supabase Dashboard에서 계정 생성

학생들이 로그인할 수 있도록 Auth 계정을 생성해야 합니다:

1. **Supabase Dashboard** → **Authentication** → **Users**
2. **Add user** 버튼 클릭
3. 학생 정보 입력:
   - Email: `학생이름@학교.com` (예: `고도윤@나루초.com`)
   - Password: 임시 비밀번호 (예: `student2024!`)
   - Auto Confirm User: ✅ 체크
4. 생성된 UUID를 복사
5. 해당 학생의 프로필 업데이트:

```sql
UPDATE user_profiles
SET id = '생성된-UUID'
WHERE full_name = '고도윤' AND class_name = '나루초 3학년 다솜반';
```

### 방법 2: 일괄 계정 생성 (추천)

각 학생의 이메일 형식을 정하고 일괄 생성:

**이메일 형식 예시:**
- `학생이름.학교@aieebss.com`
- 예: `고도윤.나루초@aieebss.com`

**임시 비밀번호:**
- 모든 학생 동일: `student2024!`
- 첫 로그인 후 변경 안내

---

## ⚠️ 주의사항

1. **UUID 자동 생성**: `gen_random_uuid()` 함수가 자동으로 UUID를 생성합니다.
2. **중복 방지**: `ON CONFLICT` 구문으로 중복 등록을 방지합니다.
3. **데이터 백업**: 실행 전 기존 데이터를 백업하세요.
4. **테스트 환경**: 가능하면 테스트 환경에서 먼저 실행해보세요.

---

## 🎯 다음 단계

1. ✅ SQL 스크립트 실행
2. ✅ 결과 확인
3. 📧 학생별 Auth 계정 생성 (로그인용)
4. 🔑 학생들에게 로그인 정보 전달
5. 🎓 교사 대시보드에서 학생 목록 확인

---

## 📞 문제 발생 시

### 오류: "relation does not exist"
→ `user_profiles` 또는 `teacher_student_assignments` 테이블이 없습니다.
→ `TEACHER_SETUP_GUIDE.md`의 1단계부터 실행하세요.

### 오류: "duplicate key value"
→ 이미 같은 이름의 학생이 존재합니다.
→ 기존 학생을 먼저 확인하거나 삭제하세요.

### 교사 UUID 오류
→ 교사 계정이 제대로 생성되지 않았습니다.
→ `QUICK_START_TEACHER.md`의 2단계를 다시 실행하세요.

---

**모든 학생이 성공적으로 등록되기를 바랍니다! 🎉**


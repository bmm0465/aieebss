# ğŸš€ í•™ìƒ ê³„ì • ì¼ê´„ ìƒì„± ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ í¬í•¨í•œ 112ëª…ì˜ í•™ìƒ ê³„ì •ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ìƒì„±ë  ê³„ì • í˜•ì‹

### ì´ë©”ì¼ ë° ë¹„ë°€ë²ˆí˜¸ ê·œì¹™

| í•™êµ | í˜•ì‹ | ì˜ˆì‹œ |
|------|------|------|
| ë‚˜ë£¨ì´ˆ | `naru{ë²ˆí˜¸}@abs.com` / `naru{ë²ˆí˜¸}` | naru1@abs.com / naru1 |
| ìš°ì•”ì´ˆ | `uam{ë²ˆí˜¸}@abs.com` / `uam{ë²ˆí˜¸}` | uam1@abs.com / uam1 |
| ë‹¨ì¬ì´ˆ 1ë°˜ | `1danjae{ë²ˆí˜¸}@abs.com` / `1danjae{ë²ˆí˜¸}` | 1danjae1@abs.com / 1danjae1 |
| ë‹¨ì¬ì´ˆ 2ë°˜ | `2danjae{ë²ˆí˜¸}@abs.com` / `2danjae{ë²ˆí˜¸}` | 2danjae1@abs.com / 2danjae1 |
| ë‹¨ì¬ì´ˆ 3ë°˜ | `3danjae{ë²ˆí˜¸}@abs.com` / `3danjae{ë²ˆí˜¸}` | 3danjae1@abs.com / 3danjae1 |

---

## ğŸ¯ ë°©ë²• 1: Supabase Dashboard ìˆ˜ë™ ë“±ë¡ (ì¶”ì²œ)

### 1ë‹¨ê³„: CSV íŒŒì¼ ì¤€ë¹„
`í•™ìƒ_ì´ë©”ì¼_ë¹„ë°€ë²ˆí˜¸_ëª©ë¡.csv` íŒŒì¼ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 2ë‹¨ê³„: Supabaseì—ì„œ ê³„ì • ìƒì„±

**ê° í•™ìƒë§ˆë‹¤ ë°˜ë³µ:**
1. Supabase Dashboard â†’ Authentication â†’ Users
2. **Add user** í´ë¦­
3. ì •ë³´ ì…ë ¥:
   - Email: `naru1@abs.com`
   - Password: `naru1`
   - Auto Confirm User: âœ… ì²´í¬
4. **Create user** í´ë¦­
5. ìƒì„±ëœ User UID ë³µì‚¬

### 3ë‹¨ê³„: í”„ë¡œí•„ê³¼ ì—°ê²°

ìƒì„±ëœ UUIDë¥¼ ì‚¬ìš©í•˜ì—¬ SQL ì‹¤í–‰:

```sql
-- 1. user_profiles ì—…ë°ì´íŠ¸
UPDATE user_profiles
SET id = 'ìƒì„±ëœ-UUID'
WHERE full_name = 'ê³ ë„ìœ¤' AND class_name = 'ë‚˜ë£¨ì´ˆ 3í•™ë…„ ë‹¤ì†œë°˜';

-- 2. êµì‚¬ì—ê²Œ ë°°ì •
INSERT INTO teacher_student_assignments (teacher_id, student_id, class_name)
VALUES ('14ea1f09-1c7f-43eb-95cf-1b491dd876a4', 'ìƒì„±ëœ-UUID', 'ë‚˜ë£¨ì´ˆ 3í•™ë…„ ë‹¤ì†œë°˜')
ON CONFLICT (teacher_id, student_id) DO NOTHING;
```

---

## ğŸ¤– ë°©ë²• 2: Node.js ìŠ¤í¬ë¦½íŠ¸ ìë™í™” (ë¹ ë¦„)

### ì „ì œ ì¡°ê±´
- Node.js ì„¤ì¹˜ í•„ìš”
- Supabase Service Role Key í•„ìš”

### 1ë‹¨ê³„: í™˜ê²½ ì„¤ì •

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
npm install @supabase/supabase-js csv-parser dotenv
```

### 2ë‹¨ê³„: .env íŒŒì¼ ìƒì„±

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ ìƒì„±:

```env
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

### 3ë‹¨ê³„: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰

```bash
node create_student_accounts.js
```

**ì‹¤í–‰ ê³¼ì •:**
1. CSV íŒŒì¼ ì½ê¸°
2. ê° í•™ìƒë§ˆë‹¤:
   - Auth ê³„ì • ìƒì„±
   - user_profilesì— í”„ë¡œí•„ ìƒì„±
   - êµì‚¬ì—ê²Œ ìë™ ë°°ì •
3. ê²°ê³¼ ì¶œë ¥

**ì˜ˆìƒ ì¶œë ¥:**
```
ğŸ“š ì´ 112ëª…ì˜ í•™ìƒ ê³„ì • ìƒì„± ì‹œì‘...

âœ… ê³ ë„ìœ¤ (naru1@abs.com) - ì„±ê³µ
âœ… ê¶Œì•„ì • (naru2@abs.com) - ì„±ê³µ
âœ… ê¹€ë„í˜„ (naru3@abs.com) - ì„±ê³µ
...

ğŸ“Š ì™„ë£Œ! ì„±ê³µ: 112ëª…, ì‹¤íŒ¨: 0ëª…
```

---

## ğŸ”§ ë°©ë²• 3: Supabase Admin API (Python)

Pythonì„ ì„ í˜¸í•˜ëŠ” ê²½ìš°:

```python
import os
import csv
import requests
from supabase import create_client, Client

SUPABASE_URL = os.environ.get("SUPABASE_URL")
SUPABASE_KEY = os.environ.get("SUPABASE_SERVICE_ROLE_KEY")

supabase: Client = create_client(SUPABASE_URL, SUPABASE_KEY)

# êµì‚¬ ë§¤í•‘
teacher_mapping = {
    'ë‚˜ë£¨ì´ˆ 3í•™ë…„ ë‹¤ì†œë°˜': '14ea1f09-1c7f-43eb-95cf-1b491dd876a4',
    'ìš°ì•”ì´ˆ 3í•™ë…„ 1ë°˜': 'fe2e88ce-bc53-4c37-825b-4bff261ef1a9',
    'ë‹¨ì¬ì´ˆ 4í•™ë…„ 1ë°˜': '3c9db811-8b08-48bc-8f0e-d515fa045d51',
    'ë‹¨ì¬ì´ˆ 4í•™ë…„ 2ë°˜': '3c9db811-8b08-48bc-8f0e-d515fa045d51',
    'ë‹¨ì¬ì´ˆ 4í•™ë…„ 3ë°˜': '3c9db811-8b08-48bc-8f0e-d515fa045d51',
}

with open('í•™ìƒ_ì´ë©”ì¼_ë¹„ë°€ë²ˆí˜¸_ëª©ë¡.csv', 'r', encoding='utf-8') as f:
    reader = csv.DictReader(f)
    for row in reader:
        try:
            # Auth ê³„ì • ìƒì„±
            auth_response = supabase.auth.admin.create_user({
                "email": row['email'],
                "password": row['password'],
                "email_confirm": True,
                "user_metadata": {
                    "full_name": row['full_name'],
                    "class_name": row['class_name']
                }
            })
            
            user_id = auth_response.user.id
            
            # í”„ë¡œí•„ ìƒì„±
            supabase.table('user_profiles').insert({
                "id": user_id,
                "full_name": row['full_name'],
                "role": "student",
                "class_name": row['class_name'],
                "student_number": row['student_number'],
                "grade_level": row['grade_level']
            }).execute()
            
            # êµì‚¬ ë°°ì •
            teacher_id = teacher_mapping.get(row['class_name'])
            if teacher_id:
                supabase.table('teacher_student_assignments').insert({
                    "teacher_id": teacher_id,
                    "student_id": user_id,
                    "class_name": row['class_name']
                }).execute()
            
            print(f"âœ… {row['full_name']} ({row['email']}) - ì„±ê³µ")
            
        except Exception as e:
            print(f"âŒ {row['full_name']} ({row['email']}) - ì‹¤íŒ¨: {e}")
```

---

## ğŸ“Š ìƒì„± í›„ í™•ì¸

### 1. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸

```
ì´ë©”ì¼: naru1@abs.com
ë¹„ë°€ë²ˆí˜¸: naru1
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸

```sql
-- Auth ê³„ì • í™•ì¸
SELECT 
  au.email,
  up.full_name,
  up.class_name,
  up.student_number
FROM auth.users au
JOIN user_profiles up ON au.id = up.id
WHERE up.class_name = 'ë‚˜ë£¨ì´ˆ 3í•™ë…„ ë‹¤ì†œë°˜'
ORDER BY CAST(up.student_number AS INTEGER);
```

### 3. êµì‚¬ ëŒ€ì‹œë³´ë“œ í™•ì¸

ê° ì„ ìƒë‹˜ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ í•™ìƒ ëª©ë¡ í™•ì¸

---

## ğŸ“‹ í•™ìƒ ë¡œê·¸ì¸ ì •ë³´ ì¶œë ¥

### í•™ìƒì—ê²Œ ì „ë‹¬í•  ìë£Œ ìƒì„±

```sql
-- ë°˜ë³„ ë¡œê·¸ì¸ ì •ë³´ ì¶œë ¥
SELECT 
  up.class_name AS ë°˜,
  up.student_number AS ë²ˆí˜¸,
  up.full_name AS ì´ë¦„,
  au.email AS ì´ë©”ì¼,
  CASE 
    WHEN au.email LIKE 'naru%' THEN REPLACE(au.email, '@abs.com', '')
    WHEN au.email LIKE 'uam%' THEN REPLACE(au.email, '@abs.com', '')
    WHEN au.email LIKE '%danjae%' THEN REPLACE(au.email, '@abs.com', '')
  END AS ë¹„ë°€ë²ˆí˜¸
FROM user_profiles up
JOIN auth.users au ON up.id = au.id
WHERE up.role = 'student'
ORDER BY up.class_name, CAST(up.student_number AS INTEGER);
```

### Excel ë‹¤ìš´ë¡œë“œìš©

CSVë¡œ ë‚´ë³´ë‚´ê¸°:
1. Supabase Dashboard â†’ SQL Editor
2. ìœ„ ì¿¼ë¦¬ ì‹¤í–‰
3. Results â†’ Download as CSV

---

## ğŸ” ë³´ì•ˆ ê¶Œì¥ì‚¬í•­

### 1. ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì•ˆë‚´

í•™ìƒë“¤ì—ê²Œ ì²« ë¡œê·¸ì¸ í›„ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì•ˆë‚´:

```
ì•ˆë…•í•˜ì„¸ìš”, [ì´ë¦„] í•™ìƒ!

ë¡œê·¸ì¸ ì •ë³´:
ì´ë©”ì¼: [ì´ë©”ì¼]
ì„ì‹œ ë¹„ë°€ë²ˆí˜¸: [ë¹„ë°€ë²ˆí˜¸]

âš ï¸ ì²« ë¡œê·¸ì¸ í›„ ë°˜ë“œì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•´ì£¼ì„¸ìš”!
```

### 2. ë¹„ë°€ë²ˆí˜¸ ì •ì±…

Supabase Dashboard â†’ Authentication â†’ Policiesì—ì„œ ì„¤ì •:
- ìµœì†Œ ê¸¸ì´: 8ì
- ë³µì¡ë„ ìš”êµ¬ì‚¬í•­ ì¶”ê°€

### 3. ì´ë©”ì¼ í™•ì¸ ë¹„í™œì„±í™”

í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œëŠ” `email_confirm: true` ì„¤ì •
í”„ë¡œë•ì…˜ì—ì„œëŠ” ì´ë©”ì¼ í™•ì¸ í™œì„±í™” ê¶Œì¥

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **API ì œí•œ**: SupabaseëŠ” ë¶„ë‹¹ API í˜¸ì¶œ ì œí•œì´ ìˆìŠµë‹ˆë‹¤.
   - ìŠ¤í¬ë¦½íŠ¸ì— ë”œë ˆì´ ì¶”ê°€ (`setTimeout` 100ms)
   - ë°°ì¹˜ í¬ê¸° ì¡°ì ˆ (20-30ëª…ì”©)

2. **Service Role Key**: ì ˆëŒ€ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ë…¸ì¶œ ê¸ˆì§€
   - ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©
   - .env íŒŒì¼ì€ .gitignoreì— ì¶”ê°€

3. **ì¤‘ë³µ ì´ë©”ì¼**: ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì€ ì˜¤ë¥˜ ë°œìƒ
   - ê¸°ì¡´ ê³„ì • ë¨¼ì € í™•ì¸
   - í•„ìš”ì‹œ ì‚­ì œ í›„ ì¬ìƒì„±

---

## ğŸ¯ ë¹ ë¥¸ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `í•™ìƒ_ì´ë©”ì¼_ë¹„ë°€ë²ˆí˜¸_ëª©ë¡.csv` í™•ì¸
- [ ] Supabase Service Role Key ì¤€ë¹„
- [ ] Node.js ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ë˜ëŠ” ìˆ˜ë™ ë“±ë¡
- [ ] ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸
- [ ] êµì‚¬ ëŒ€ì‹œë³´ë“œì—ì„œ í•™ìƒ ëª©ë¡ í™•ì¸
- [ ] í•™ìƒë“¤ì—ê²Œ ë¡œê·¸ì¸ ì •ë³´ ì „ë‹¬

---

## ğŸ“ ë¬¸ì œ í•´ê²°

### ì˜¤ë¥˜: "Email rate limit exceeded"
â†’ API í˜¸ì¶œì´ ë„ˆë¬´ ë¹ ë¦…ë‹ˆë‹¤. ë”œë ˆì´ë¥¼ ëŠ˜ë¦¬ì„¸ìš” (500ms-1000ms)

### ì˜¤ë¥˜: "User already registered"
â†’ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì´ë©”ì¼ì„ ì‚¬ìš©í•˜ì„¸ìš”.

### ì˜¤ë¥˜: "Invalid service role key"
â†’ Service Role Keyê°€ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤. Supabase ì„¤ì • í™•ì¸

---

**ëª¨ë“  í•™ìƒ ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤! ğŸ‰**

